<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.7"/>
<title>AVRISP-MKII Clone Programmer Project: AVRISP MKII Programmer Project</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript">
  $(document).ready(initResizable);
  $(window).load(resizeHeight);
</script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td style="padding-left: 0.5em;">
   <div id="projectname">AVRISP-MKII Clone Programmer Project
   &#160;<span id="projectnumber">0.0.0</span>
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.7 -->
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li class="current"><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li><a href="annotated.html"><span>Data&#160;Structures</span></a></li>
      <li><a href="files.html"><span>Files</span></a></li>
    </ul>
  </div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
$(document).ready(function(){initNavTree('index.html','');});
</script>
<div id="doc-content">
<div class="header">
  <div class="headertitle">
<div class="title">AVRISP MKII Programmer Project </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><h1><a class="anchor" id="SSec_Compat"></a>
Project Compatibility:</h1>
<p>The following list indicates what microcontrollers are compatible with this project.</p>
<ul>
<li>Series 7 USB AVRs</li>
<li>Series 6 USB AVRs</li>
<li>Series 4 USB AVRs</li>
<li>Series 2 USB AVRs (8KB versions with reduced features only)</li>
</ul>
<h1><a class="anchor" id="SSec_Info"></a>
USB Information:</h1>
<p>The following table gives a rundown of the USB utilization of this project.</p>
<table class="doxtable">
<tr>
<td><b>USB Mode:</b> </td><td>Device  </td></tr>
<tr>
<td><b>USB Class:</b> </td><td>Vendor Specific Class  </td></tr>
<tr>
<td><b>USB Subclass:</b> </td><td>N/A  </td></tr>
<tr>
<td><b>Relevant Standards:</b> </td><td>Atmel AVRISP MKII Protocol Specification  </td></tr>
<tr>
<td><b>Usable Speeds:</b> </td><td>Full Speed Mode  </td></tr>
</table>
<h1><a class="anchor" id="SSec_Description"></a>
Project Description:</h1>
<p>Firmware for an AVRStudio compatible AVRISP-MKII clone programmer. This project will enable the USB AVR series of microcontrollers to act as a clone of the official Atmel AVRISP-MKII programmer, usable within AVRStudio. In its most basic form, it allows for the programming of 5V AVRs from within AVRStudio with no special hardware other than the USB AVR and the parts needed for the USB interface. If the user desires, more advanced circuits incorporating level conversion can be made to allow for the programming of 3.3V AVR designs.</p>
<p>This device spoofs Atmel's official AVRISP-MKII device PID so that it remains compatible with Atmel's AVRISP-MKII drivers. When prompted, direct your OS to install Atmel's AVRISP-MKII drivers provided with AVRStudio.</p>
<p>Note that this design currently has the following limitations:</p><ul>
<li>No reversed/shorted target connector detection and notification</li>
<li>A separate header is required for each of the ISP, PDI and TPI programming protocols that the user wishes to use</li>
</ul>
<p>On AVR models with an ADC converter, AVCC should be tied to 5V (e.g. VBUS) and the VTARGET_ADC_CHANNEL token should be set to an appropriate ADC channel number in the project makefile for VTARGET detection to operate correctly. On models without an ADC converter, VTARGET will report a fixed 5V level at all times.</p>
<p>While this application can be compiled for USB AVRs with as little as 8KB of FLASH, for full functionality 16KB or more of FLASH is required. On 8KB devices, ISP or PDI/TPI programming support can be disabled to reduce program size.</p>
<h1><a class="anchor" id="Sec_ISP"></a>
ISP Connections</h1>
<p>Connections to the device for SPI programming (when enabled):</p>
<table class="doxtable">
<tr>
<td><b>Programmer Pin:</b> </td><td><b>Target Device Pin:</b> </td><td><b>ISP 6 Pin Layout:</b>  </td></tr>
<tr>
<td>MISO </td><td>PDO </td><td>1  </td></tr>
<tr>
<td>ADCx <b><sup>1</sup></b> </td><td>VTARGET </td><td>2  </td></tr>
<tr>
<td>SCLK </td><td>SCLK </td><td>3  </td></tr>
<tr>
<td>MOSI </td><td>PDI </td><td>4  </td></tr>
<tr>
<td>PORTx.y <b><sup>2</sup></b> </td><td>/RESET </td><td>5  </td></tr>
<tr>
<td>GND </td><td>GND </td><td>6  </td></tr>
</table>
<p>In addition, the AVR's XCK pin will generate a .5MHz clock when SPI programming is used, to act as an external device clock if the fuses have been mis-set. To use the recovery clock, connect XCK to the target AVR's XTAL1 pin, and set the ISP programming speed to 125KHz or below.</p>
<p><b><sup>1</sup></b> <em>Optional, see <a class="el" href="index.html#SSec_Options">Project Options</a> section - for USB AVRs with ADC modules only</em> <br />
 <b><sup>2</sup></b> <em>See AUX line related tokens in the <a class="el" href="index.html#SSec_Options">Project Options</a> section</em></p>
<h1><a class="anchor" id="Sec_PDI"></a>
PDI Connections</h1>
<p>Connections to the device for PDI programming (when enabled):</p>
<table class="doxtable">
<tr>
<td><b>Programmer Pin:</b> </td><td><b>Target Device Pin:</b> </td><td><b>PDI 6 Pin Layout:</b>  </td></tr>
<tr>
<td>Tx/Rx <b><sup>2</sup></b> </td><td>DATA </td><td>1  </td></tr>
<tr>
<td>ADCx <b><sup>1</sup></b> </td><td>VTARGET </td><td>2  </td></tr>
<tr>
<td>N/A </td><td>N/A </td><td>3  </td></tr>
<tr>
<td>N/A </td><td>N/A </td><td>4  </td></tr>
<tr>
<td>XCK </td><td>CLOCK </td><td>5  </td></tr>
<tr>
<td>GND </td><td>GND </td><td>6  </td></tr>
</table>
<p><b><sup>1</sup></b> <em>Optional, see <a class="el" href="index.html#SSec_Options">Project Options</a> section - for USB AVRs with ADC modules only</em> <br />
 <b><sup>2</sup></b> <em>The AVR's Tx and Rx become the DATA line when connected together via a pair of 220 ohm resistors</em> <br />
 </p>
<h1><a class="anchor" id="Sec_TPI"></a>
TPI Connections</h1>
<p>Connections to the device for TPI programming (when enabled):</p>
<table class="doxtable">
<tr>
<td><b>Programmer Pin:</b> </td><td><b>Target Device Pin:</b> </td><td><b>TPI 6 Pin Layout:</b>  </td></tr>
<tr>
<td>Tx/Rx <b><sup>2</sup></b> </td><td>DATA </td><td>1  </td></tr>
<tr>
<td>ADCx <b><sup>1</sup></b> </td><td>VTARGET </td><td>2  </td></tr>
<tr>
<td>XCK <b><sup>2</sup></b> </td><td>CLOCK </td><td>3  </td></tr>
<tr>
<td>N/A </td><td>N/A </td><td>4  </td></tr>
<tr>
<td>PORTx.y <b><sup>3</sup></b> </td><td>/RESET </td><td>5  </td></tr>
<tr>
<td>GND </td><td>GND </td><td>6  </td></tr>
</table>
<p><b><sup>1</sup></b> <em>Optional, see <a class="el" href="index.html#SSec_Options">Project Options</a> section - for USB AVRs with ADC modules only</em> <br />
 <b><sup>2</sup></b> <em>The AVR's Tx and Rx become the DATA line when connected together via a pair of 220 ohm resistors</em> <br />
 <b><sup>3</sup></b> <em>See AUX line related tokens in the <a class="el" href="index.html#SSec_Options">Project Options</a> section</em></p>
<h1><a class="anchor" id="SSec_Options"></a>
Project Options</h1>
<p>The following defines can be found in this project, which can control the project behaviour when defined, or changed in value.</p>
<table class="doxtable">
<tr>
<td><b>Define Name:</b> </td><td><b>Location:</b> </td><td><b>Description:</b>  </td></tr>
<tr>
<td>AUX_LINE_PORT </td><td>Makefile LUFA_OPTS </td><td>PORT register for the programmer's AUX target line. The use of this line varies between the programming protocols, but is generally used for the target's /RESET line. <em>Ignored when compiled for the XPLAIN board.</em>  </td></tr>
<tr>
<td>AUX_LINE_PIN </td><td>Makefile LUFA_OPTS </td><td>PIN register for the programmer's AUX target line. The use of this line varies between the programming protocols, but is generally used for the target's /RESET line. <em>Ignored when compiled for the XPLAIN board.</em>  </td></tr>
<tr>
<td>AUX_LINE_DDR </td><td>Makefile LUFA_OPTS </td><td>DDR register for the programmer's AUX target line. The use of this line varies between the programming protocols, but is generally used for the target's /RESET line. <em>Ignored when compiled for the XPLAIN board.</em>  </td></tr>
<tr>
<td>AUX_LINE_MASK </td><td>Makefile LUFA_OPTS </td><td>Mask for the programmer's AUX target line. The use of this line varies between the programming protocols, but is generally used for the target's /RESET line. <b>Must not be the AVR's /SS pin</b>. <em>Ignored when compiled for the XPLAIN board.</em>  </td></tr>
<tr>
<td>VTARGET_ADC_CHANNEL </td><td>Makefile LUFA_OPTS </td><td>ADC channel number (on supported AVRs) to use for VTARGET level detection, if NO_VTARGET_DETECT is not defined. <em>Ignored when compiled for targets lacking an ADC.</em>  </td></tr>
<tr>
<td>ENABLE_ISP_PROTOCOL </td><td>Makefile LUFA_OPTS </td><td>Define to enable SPI programming protocol support. <em>Ignored when compiled for the XPLAIN board.</em>  </td></tr>
<tr>
<td>ENABLE_XPROG_PROTOCOL </td><td>Makefile LUFA_OPTS </td><td>Define to enable PDI and TPI programming protocol support. <em>Ignored when compiled for the XPLAIN board.</em>  </td></tr>
<tr>
<td>NO_VTARGET_DETECT </td><td>Makefile LUFA_OPTS </td><td>Define to disable VTARGET sampling and reporting on AVR models with an ADC converter. This will cause the programmer to report a fixed 5V target voltage to the host regardless of the real target voltage. <em>Ignored when compiled for targets lacking an ADC.</em>  </td></tr>
<tr>
<td>VTARGET_REF_VOLTS </td><td>Makefile LUFA_OPTS </td><td>Indicates the programmer AVR's AVCC reference voltage when measuring the target's supply voltage. Note that the supply voltage should never exceed the reference voltage on the programmer AVR without some form of protection to prevent damage to the ADC. <em>Ignored when compiled for targets lacking an ADC, or when NO_VTARGET_DETECT is defined.</em>  </td></tr>
<tr>
<td>VTARGET_SCALE_FACTOR </td><td>Makefile LUFA_OPTS </td><td>Indicates the target's supply voltage scale factor when applied to the ADC. A simple resistive divider can be used on the ADC pin for measuring the target's supply voltage, so that voltages above the programmer AVR's AVCC reference voltage can be measured. This should be the reciprocal of the division performed - e.g. if the VTARGET voltage is halved, this should be set to 2. <em>Ignored when compiled for targets lacking an ADC, or when NO_VTARGET_DETECT is defined.</em>  </td></tr>
<tr>
<td>LIBUSB_DRIVER_COMPAT </td><td>Makefile LUFA_OPTS </td><td>Define to switch to a non-standard endpoint scheme, breaking compatibility with AVRStudio under Windows but making the code compatible with software such as avrdude (all platforms) that use the libUSB driver.  </td></tr>
</table>
</div></div><!-- contents -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="footer">Generated by
    <a href="http://www.doxygen.org/index.html">
    <img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.8.7 </li>
  </ul>
</div>
</body>
</html>
