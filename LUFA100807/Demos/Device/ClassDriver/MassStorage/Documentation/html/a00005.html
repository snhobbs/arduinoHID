<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.7"/>
<title>LUFA Library - Mass Storage Device Demo: Lib/DataflashManager.h File Reference</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript">
  $(document).ready(initResizable);
  $(window).load(resizeHeight);
</script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td style="padding-left: 0.5em;">
   <div id="projectname">LUFA Library - Mass Storage Device Demo
   &#160;<span id="projectnumber">0.0.0</span>
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.7 -->
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li><a href="annotated.html"><span>Data&#160;Structures</span></a></li>
      <li class="current"><a href="files.html"><span>Files</span></a></li>
    </ul>
  </div>
  <div id="navrow2" class="tabs2">
    <ul class="tablist">
      <li><a href="files.html"><span>File&#160;List</span></a></li>
      <li><a href="globals.html"><span>Globals</span></a></li>
    </ul>
  </div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
$(document).ready(function(){initNavTree('a00005.html','');});
</script>
<div id="doc-content">
<div class="header">
  <div class="summary">
<a href="#define-members">Macros</a> &#124;
<a href="#func-members">Functions</a>  </div>
  <div class="headertitle">
<div class="title">DataflashManager.h File Reference</div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><code>#include &lt;avr/io.h&gt;</code><br />
<code>#include &quot;<a class="el" href="a00009.html">MassStorage.h</a>&quot;</code><br />
<code>#include &quot;<a class="el" href="a00003.html">Descriptors.h</a>&quot;</code><br />
<code>#include &lt;LUFA/Common/Common.h&gt;</code><br />
<code>#include &lt;LUFA/Drivers/USB/USB.h&gt;</code><br />
<code>#include &lt;LUFA/Drivers/USB/Class/MassStorage.h&gt;</code><br />
<code>#include &lt;LUFA/Drivers/Board/Dataflash.h&gt;</code><br />
</div><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="define-members"></a>
Macros</h2></td></tr>
<tr class="memitem:a75e71d42353f289bf69072860957f892"><td class="memItemLeft" align="right" valign="top">#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="a00005.html#a75e71d42353f289bf69072860957f892">VIRTUAL_MEMORY_BYTES</a>&#160;&#160;&#160;((uint32_t)DATAFLASH_PAGES * DATAFLASH_PAGE_SIZE * DATAFLASH_TOTALCHIPS)</td></tr>
<tr class="separator:a75e71d42353f289bf69072860957f892"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a46b701cd2078c2091bd4678e38ce8e64"><td class="memItemLeft" align="right" valign="top">#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="a00005.html#a46b701cd2078c2091bd4678e38ce8e64">VIRTUAL_MEMORY_BLOCK_SIZE</a>&#160;&#160;&#160;512</td></tr>
<tr class="separator:a46b701cd2078c2091bd4678e38ce8e64"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a8a35bb45c35f767e6a567917bc28a303"><td class="memItemLeft" align="right" valign="top">#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="a00005.html#a8a35bb45c35f767e6a567917bc28a303">VIRTUAL_MEMORY_BLOCKS</a>&#160;&#160;&#160;(<a class="el" href="a00005.html#a75e71d42353f289bf69072860957f892">VIRTUAL_MEMORY_BYTES</a> / <a class="el" href="a00005.html#a46b701cd2078c2091bd4678e38ce8e64">VIRTUAL_MEMORY_BLOCK_SIZE</a>)</td></tr>
<tr class="separator:a8a35bb45c35f767e6a567917bc28a303"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="func-members"></a>
Functions</h2></td></tr>
<tr class="memitem:a9dfc73717cb9f997b087b53c21b48de1"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="a00005.html#a9dfc73717cb9f997b087b53c21b48de1">DataflashManager_WriteBlocks</a> (USB_ClassInfo_MS_Device_t *const MSInterfaceInfo, const uint32_t BlockAddress, uint16_t TotalBlocks)</td></tr>
<tr class="separator:a9dfc73717cb9f997b087b53c21b48de1"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ab8ac45b04058b352b4fe46c20caa5dad"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="a00005.html#ab8ac45b04058b352b4fe46c20caa5dad">DataflashManager_ReadBlocks</a> (USB_ClassInfo_MS_Device_t *const MSInterfaceInfo, const uint32_t BlockAddress, uint16_t TotalBlocks)</td></tr>
<tr class="separator:ab8ac45b04058b352b4fe46c20caa5dad"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a95bc60bd0175fd5089a220f32e4c15da"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="a00005.html#a95bc60bd0175fd5089a220f32e4c15da">DataflashManager_WriteBlocks_RAM</a> (const uint32_t BlockAddress, uint16_t TotalBlocks, uint8_t *BufferPtr) ATTR_NON_NULL_PTR_ARG(3)</td></tr>
<tr class="separator:a95bc60bd0175fd5089a220f32e4c15da"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a50a0ad75a68d1d20f2f23d9db20a0ff7"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="a00005.html#a50a0ad75a68d1d20f2f23d9db20a0ff7">DataflashManager_ReadBlocks_RAM</a> (const uint32_t BlockAddress, uint16_t TotalBlocks, uint8_t *BufferPtr) ATTR_NON_NULL_PTR_ARG(3)</td></tr>
<tr class="separator:a50a0ad75a68d1d20f2f23d9db20a0ff7"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:adb32091fc613a95c74b5e2aeb796edcb"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="a00005.html#adb32091fc613a95c74b5e2aeb796edcb">DataflashManager_ResetDataflashProtections</a> (void)</td></tr>
<tr class="separator:adb32091fc613a95c74b5e2aeb796edcb"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:aade28aa749d379f98f07faa43e54d902"><td class="memItemLeft" align="right" valign="top">bool&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="a00005.html#aade28aa749d379f98f07faa43e54d902">DataflashManager_CheckDataflashOperation</a> (void)</td></tr>
<tr class="separator:aade28aa749d379f98f07faa43e54d902"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table>
<a name="details" id="details"></a><h2 class="groupheader">Detailed Description</h2>
<div class="textblock"><p>Header file for <a class="el" href="a00004.html">DataflashManager.c</a>. </p>
</div><h2 class="groupheader">Macro Definition Documentation</h2>
<a class="anchor" id="a46b701cd2078c2091bd4678e38ce8e64"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define VIRTUAL_MEMORY_BLOCK_SIZE&#160;&#160;&#160;512</td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Block size of the device. This is kept at 512 to remain compatible with the OS despite the underlying storage media (Dataflash) using a different native block size. Do not change this value. </p>

</div>
</div>
<a class="anchor" id="a8a35bb45c35f767e6a567917bc28a303"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define VIRTUAL_MEMORY_BLOCKS&#160;&#160;&#160;(<a class="el" href="a00005.html#a75e71d42353f289bf69072860957f892">VIRTUAL_MEMORY_BYTES</a> / <a class="el" href="a00005.html#a46b701cd2078c2091bd4678e38ce8e64">VIRTUAL_MEMORY_BLOCK_SIZE</a>)</td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Total number of blocks of the virtual memory for reporting to the host as the device's total capacity. Do not change this value; change VIRTUAL_MEMORY_BYTES instead to alter the media size. </p>

</div>
</div>
<a class="anchor" id="a75e71d42353f289bf69072860957f892"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define VIRTUAL_MEMORY_BYTES&#160;&#160;&#160;((uint32_t)DATAFLASH_PAGES * DATAFLASH_PAGE_SIZE * DATAFLASH_TOTALCHIPS)</td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Total number of bytes of the storage medium, comprised of one or more Dataflash ICs. </p>

</div>
</div>
<h2 class="groupheader">Function Documentation</h2>
<a class="anchor" id="aade28aa749d379f98f07faa43e54d902"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">bool DataflashManager_CheckDataflashOperation </td>
          <td>(</td>
          <td class="paramtype">void&#160;</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Performs a simple test on the attached Dataflash IC(s) to ensure that they are working.</p>
<dl class="section return"><dt>Returns</dt><dd>Boolean true if all media chips are working, false otherwise </dd></dl>

</div>
</div>
<a class="anchor" id="ab8ac45b04058b352b4fe46c20caa5dad"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void DataflashManager_ReadBlocks </td>
          <td>(</td>
          <td class="paramtype">USB_ClassInfo_MS_Device_t *const&#160;</td>
          <td class="paramname"><em>MSInterfaceInfo</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const uint32_t&#160;</td>
          <td class="paramname"><em>BlockAddress</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">uint16_t&#160;</td>
          <td class="paramname"><em>TotalBlocks</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Reads blocks (OS blocks, not Dataflash pages) from the storage medium, the board Dataflash IC(s), into the pre-selected data IN endpoint. This routine reads in Dataflash page sized blocks from the Dataflash and writes them in OS sized blocks to the endpoint.</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in]</td><td class="paramname">MSInterfaceInfo</td><td>Pointer to a structure containing a Mass Storage Class configuration and state </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">BlockAddress</td><td>Data block starting address for the read sequence </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">TotalBlocks</td><td>Number of blocks of data to read </td></tr>
  </table>
  </dd>
</dl>

</div>
</div>
<a class="anchor" id="a50a0ad75a68d1d20f2f23d9db20a0ff7"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void DataflashManager_ReadBlocks_RAM </td>
          <td>(</td>
          <td class="paramtype">const uint32_t&#160;</td>
          <td class="paramname"><em>BlockAddress</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">uint16_t&#160;</td>
          <td class="paramname"><em>TotalBlocks</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">uint8_t *&#160;</td>
          <td class="paramname"><em>BufferPtr</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Reads blocks (OS blocks, not Dataflash pages) from the storage medium, the board Dataflash IC(s), into the a preallocated RAM buffer. This routine reads in Dataflash page sized blocks from the Dataflash and writes them in OS sized blocks to the given buffer. This can be linked to FAT libraries to read the files stored on the Dataflash.</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in]</td><td class="paramname">BlockAddress</td><td>Data block starting address for the read sequence </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">TotalBlocks</td><td>Number of blocks of data to read </td></tr>
    <tr><td class="paramdir">[out]</td><td class="paramname">BufferPtr</td><td>Pointer to the data destination RAM buffer </td></tr>
  </table>
  </dd>
</dl>

</div>
</div>
<a class="anchor" id="adb32091fc613a95c74b5e2aeb796edcb"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void DataflashManager_ResetDataflashProtections </td>
          <td>(</td>
          <td class="paramtype">void&#160;</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Disables the Dataflash memory write protection bits on the board Dataflash ICs, if enabled. </p>

</div>
</div>
<a class="anchor" id="a9dfc73717cb9f997b087b53c21b48de1"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void DataflashManager_WriteBlocks </td>
          <td>(</td>
          <td class="paramtype">USB_ClassInfo_MS_Device_t *const&#160;</td>
          <td class="paramname"><em>MSInterfaceInfo</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const uint32_t&#160;</td>
          <td class="paramname"><em>BlockAddress</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">uint16_t&#160;</td>
          <td class="paramname"><em>TotalBlocks</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Writes blocks (OS blocks, not Dataflash pages) to the storage medium, the board Dataflash IC(s), from the pre-selected data OUT endpoint. This routine reads in OS sized blocks from the endpoint and writes them to the Dataflash in Dataflash page sized blocks.</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in]</td><td class="paramname">MSInterfaceInfo</td><td>Pointer to a structure containing a Mass Storage Class configuration and state </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">BlockAddress</td><td>Data block starting address for the write sequence </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">TotalBlocks</td><td>Number of blocks of data to write </td></tr>
  </table>
  </dd>
</dl>

</div>
</div>
<a class="anchor" id="a95bc60bd0175fd5089a220f32e4c15da"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void DataflashManager_WriteBlocks_RAM </td>
          <td>(</td>
          <td class="paramtype">const uint32_t&#160;</td>
          <td class="paramname"><em>BlockAddress</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">uint16_t&#160;</td>
          <td class="paramname"><em>TotalBlocks</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">uint8_t *&#160;</td>
          <td class="paramname"><em>BufferPtr</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Writes blocks (OS blocks, not Dataflash pages) to the storage medium, the board Dataflash IC(s), from the a given RAM buffer. This routine reads in OS sized blocks from the buffer and writes them to the Dataflash in Dataflash page sized blocks. This can be linked to FAT libraries to write files to the Dataflash.</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in]</td><td class="paramname">BlockAddress</td><td>Data block starting address for the write sequence </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">TotalBlocks</td><td>Number of blocks of data to write </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">BufferPtr</td><td>Pointer to the data source RAM buffer </td></tr>
  </table>
  </dd>
</dl>

</div>
</div>
</div><!-- contents -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="navelem"><a class="el" href="dir_8f3de2ae926fecfe6abd5379fd2b6eb1.html">Lib</a></li><li class="navelem"><a class="el" href="a00005.html">DataflashManager.h</a></li>
    <li class="footer">Generated by
    <a href="http://www.doxygen.org/index.html">
    <img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.8.7 </li>
  </ul>
</div>
</body>
</html>
