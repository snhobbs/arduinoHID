<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.7"/>
<title>LUFA Library - Mass Storage Host Demo: Lib/MassStoreCommands.c File Reference</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript">
  $(document).ready(initResizable);
  $(window).load(resizeHeight);
</script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td style="padding-left: 0.5em;">
   <div id="projectname">LUFA Library - Mass Storage Host Demo
   &#160;<span id="projectnumber">0.0.0</span>
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.7 -->
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li><a href="annotated.html"><span>Data&#160;Structures</span></a></li>
      <li class="current"><a href="files.html"><span>Files</span></a></li>
    </ul>
  </div>
  <div id="navrow2" class="tabs2">
    <ul class="tablist">
      <li><a href="files.html"><span>File&#160;List</span></a></li>
      <li><a href="globals.html"><span>Globals</span></a></li>
    </ul>
  </div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
$(document).ready(function(){initNavTree('a00008.html','');});
</script>
<div id="doc-content">
<div class="header">
  <div class="summary">
<a href="#func-members">Functions</a> &#124;
<a href="#var-members">Variables</a>  </div>
  <div class="headertitle">
<div class="title">MassStoreCommands.c File Reference</div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><code>#include &quot;<a class="el" href="a00009.html">MassStoreCommands.h</a>&quot;</code><br />
</div><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="func-members"></a>
Functions</h2></td></tr>
<tr class="memitem:a7f889907d9bfcdb0ab685b32d26458f9"><td class="memItemLeft" align="right" valign="top">static uint8_t&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="a00008.html#a7f889907d9bfcdb0ab685b32d26458f9">MassStore_SendCommand</a> (<a class="el" href="a00001.html">CommandBlockWrapper_t</a> *const SCSICommandBlock, void *BufferPtr)</td></tr>
<tr class="separator:a7f889907d9bfcdb0ab685b32d26458f9"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a0c13e34b17c949e38edd360284deeac0"><td class="memItemLeft" align="right" valign="top">static uint8_t&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="a00008.html#a0c13e34b17c949e38edd360284deeac0">MassStore_WaitForDataReceived</a> (void)</td></tr>
<tr class="separator:a0c13e34b17c949e38edd360284deeac0"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:aa02649a92bc7603ad9f4e90aa48522d8"><td class="memItemLeft" align="right" valign="top">static uint8_t&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="a00008.html#aa02649a92bc7603ad9f4e90aa48522d8">MassStore_SendReceiveData</a> (<a class="el" href="a00001.html">CommandBlockWrapper_t</a> *const SCSICommandBlock, void *BufferPtr)</td></tr>
<tr class="separator:aa02649a92bc7603ad9f4e90aa48522d8"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ace5f90a05b7bc69f166c3b0eb148a4d7"><td class="memItemLeft" align="right" valign="top">static uint8_t&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="a00008.html#ace5f90a05b7bc69f166c3b0eb148a4d7">MassStore_GetReturnedStatus</a> (<a class="el" href="a00002.html">CommandStatusWrapper_t</a> *const SCSICommandStatus)</td></tr>
<tr class="separator:ace5f90a05b7bc69f166c3b0eb148a4d7"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ac6b179eea18f5d947233a95bb5d85483"><td class="memItemLeft" align="right" valign="top">uint8_t&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="a00008.html#ac6b179eea18f5d947233a95bb5d85483">MassStore_MassStorageReset</a> (void)</td></tr>
<tr class="separator:ac6b179eea18f5d947233a95bb5d85483"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ad80d5405f03c08f662de9db05163f82b"><td class="memItemLeft" align="right" valign="top">uint8_t&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="a00008.html#ad80d5405f03c08f662de9db05163f82b">MassStore_GetMaxLUN</a> (uint8_t *const MaxLUNIndex)</td></tr>
<tr class="separator:ad80d5405f03c08f662de9db05163f82b"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a4392f4ea50411d0918711ae6dc935c16"><td class="memItemLeft" align="right" valign="top">uint8_t&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="a00008.html#a4392f4ea50411d0918711ae6dc935c16">MassStore_Inquiry</a> (const uint8_t LUNIndex, <a class="el" href="a00004.html">SCSI_Inquiry_Response_t</a> *const InquiryPtr)</td></tr>
<tr class="separator:a4392f4ea50411d0918711ae6dc935c16"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a5640cbec94f4320ae1bd4b2dfa62b475"><td class="memItemLeft" align="right" valign="top">uint8_t&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="a00008.html#a5640cbec94f4320ae1bd4b2dfa62b475">MassStore_RequestSense</a> (const uint8_t LUNIndex, <a class="el" href="a00005.html">SCSI_Request_Sense_Response_t</a> *const SensePtr)</td></tr>
<tr class="separator:a5640cbec94f4320ae1bd4b2dfa62b475"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a5d22ef9933e52861549688342804ddaf"><td class="memItemLeft" align="right" valign="top">uint8_t&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="a00008.html#a5d22ef9933e52861549688342804ddaf">MassStore_ReadDeviceBlock</a> (const uint8_t LUNIndex, const uint32_t BlockAddress, const uint8_t Blocks, const uint16_t BlockSize, void *BufferPtr)</td></tr>
<tr class="separator:a5d22ef9933e52861549688342804ddaf"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a5726b87e98539242273e112acec239d6"><td class="memItemLeft" align="right" valign="top">uint8_t&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="a00008.html#a5726b87e98539242273e112acec239d6">MassStore_WriteDeviceBlock</a> (const uint8_t LUNIndex, const uint32_t BlockAddress, const uint8_t Blocks, const uint16_t BlockSize, void *BufferPtr)</td></tr>
<tr class="separator:a5726b87e98539242273e112acec239d6"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ad8e1a76103edb7da05f5c28d805ad985"><td class="memItemLeft" align="right" valign="top">uint8_t&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="a00008.html#ad8e1a76103edb7da05f5c28d805ad985">MassStore_TestUnitReady</a> (const uint8_t LUNIndex)</td></tr>
<tr class="separator:ad8e1a76103edb7da05f5c28d805ad985"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a7d950ea34c6a5d68f6d35dc9b1bb5b9a"><td class="memItemLeft" align="right" valign="top">uint8_t&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="a00008.html#a7d950ea34c6a5d68f6d35dc9b1bb5b9a">MassStore_ReadCapacity</a> (const uint8_t LUNIndex, <a class="el" href="a00003.html">SCSI_Capacity_t</a> *const CapacityPtr)</td></tr>
<tr class="separator:a7d950ea34c6a5d68f6d35dc9b1bb5b9a"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a2886bf820904f36ca464ba357219e649"><td class="memItemLeft" align="right" valign="top">uint8_t&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="a00008.html#a2886bf820904f36ca464ba357219e649">MassStore_PreventAllowMediumRemoval</a> (const uint8_t LUNIndex, const bool PreventRemoval)</td></tr>
<tr class="separator:a2886bf820904f36ca464ba357219e649"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="var-members"></a>
Variables</h2></td></tr>
<tr class="memitem:a976546b67de109f645714ba6085fc1bf"><td class="memItemLeft" align="right" valign="top">static uint32_t&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="a00008.html#a976546b67de109f645714ba6085fc1bf">MassStore_Tag</a> = 1</td></tr>
<tr class="separator:a976546b67de109f645714ba6085fc1bf"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table>
<a name="details" id="details"></a><h2 class="groupheader">Detailed Description</h2>
<div class="textblock"><p>Mass Storage Device commands, to issue MSD commands to the device for reading device status, capacity, and other characteristics. This file also contains block read and write functions, so that device blocks can be read and written. In general, these functions would be chained to a FAT library to give file-level access to an attached device's contents.</p>
<dl class="section note"><dt>Note</dt><dd>Many Mass Storage devices on the market are non-compliant to the specifications and thus can prove difficult to interface with. It may be necessary to retry the functions in the module several times after they have returned and error to successfully send the command to the device. Some devices may also need to have the stream function timeout period extended beyond 100ms (some badly designed devices exceeding 1.5 seconds occasionally) by defining USB_STREAM_TIMEOUT_MS to a larger value in the project makefile and passing it to the compiler via the -D switch. </dd></dl>
</div><h2 class="groupheader">Function Documentation</h2>
<a class="anchor" id="ad80d5405f03c08f662de9db05163f82b"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">uint8_t MassStore_GetMaxLUN </td>
          <td>(</td>
          <td class="paramtype">uint8_t *const&#160;</td>
          <td class="paramname"><em>MaxLUNIndex</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Issues a Mass Storage class specific request to determine the index of the highest numbered Logical Unit in the attached device.</p>
<dl class="section note"><dt>Note</dt><dd>Some devices do not support this request, and will STALL it when issued. To get around this, on unsupported devices the max LUN index will be reported as zero and no error will be returned if the device STALLs the request.</dd></dl>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[out]</td><td class="paramname">MaxLUNIndex</td><td>Pointer to the location that the maximum LUN index value should be stored</td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>A value from the USB_Host_SendControlErrorCodes_t enum, or MASS_STORE_SCSI_COMMAND_FAILED if the SCSI command fails </dd></dl>

</div>
</div>
<a class="anchor" id="ace5f90a05b7bc69f166c3b0eb148a4d7"></a>
<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static uint8_t MassStore_GetReturnedStatus </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="a00002.html">CommandStatusWrapper_t</a> *const&#160;</td>
          <td class="paramname"><em>SCSICommandStatus</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">
<p>Routine to receive the current CSW from the device.</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[out]</td><td class="paramname">SCSICommandStatus</td><td>Pointer to a destination where the returned status data should be stored</td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>A value from the Pipe_Stream_RW_ErrorCodes_t enum, or MASS_STORE_SCSI_COMMAND_FAILED if the SCSI command fails </dd></dl>

</div>
</div>
<a class="anchor" id="a4392f4ea50411d0918711ae6dc935c16"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">uint8_t MassStore_Inquiry </td>
          <td>(</td>
          <td class="paramtype">const uint8_t&#160;</td>
          <td class="paramname"><em>LUNIndex</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="a00004.html">SCSI_Inquiry_Response_t</a> *const&#160;</td>
          <td class="paramname"><em>InquiryPtr</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Issues a SCSI Inquiry command to the attached device, to determine the device's information. This gives information on the device's capabilities.</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in]</td><td class="paramname">LUNIndex</td><td>Index of the LUN inside the device the command is being addressed to </td></tr>
    <tr><td class="paramdir">[out]</td><td class="paramname">InquiryPtr</td><td>Pointer to the inquiry data structure where the inquiry data from the device is to be stored</td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>A value from the Pipe_Stream_RW_ErrorCodes_t enum, or MASS_STORE_SCSI_COMMAND_FAILED if the SCSI command fails </dd></dl>

</div>
</div>
<a class="anchor" id="ac6b179eea18f5d947233a95bb5d85483"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">uint8_t MassStore_MassStorageReset </td>
          <td>(</td>
          <td class="paramtype">void&#160;</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Issues a Mass Storage class specific request to reset the attached device's Mass Storage interface, readying the device for the next CBW.</p>
<dl class="section return"><dt>Returns</dt><dd>A value from the USB_Host_SendControlErrorCodes_t enum, or MASS_STORE_SCSI_COMMAND_FAILED if the SCSI command fails </dd></dl>

</div>
</div>
<a class="anchor" id="a2886bf820904f36ca464ba357219e649"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">uint8_t MassStore_PreventAllowMediumRemoval </td>
          <td>(</td>
          <td class="paramtype">const uint8_t&#160;</td>
          <td class="paramname"><em>LUNIndex</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const bool&#160;</td>
          <td class="paramname"><em>PreventRemoval</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Issues a SCSI Device Prevent/Allow Medium Removal command to the attached device, to lock the physical media from being removed. This is a legacy command for SCSI disks with removable storage (such as ZIP disks), but should still be issued before the first read or write command is sent.</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in]</td><td class="paramname">LUNIndex</td><td>Index of the LUN inside the device the command is being addressed to </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">PreventRemoval</td><td>Whether or not the LUN media should be locked to prevent removal or not</td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>A value from the Pipe_Stream_RW_ErrorCodes_t enum, or MASS_STORE_SCSI_COMMAND_FAILED if the SCSI command fails </dd></dl>

</div>
</div>
<a class="anchor" id="a7d950ea34c6a5d68f6d35dc9b1bb5b9a"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">uint8_t MassStore_ReadCapacity </td>
          <td>(</td>
          <td class="paramtype">const uint8_t&#160;</td>
          <td class="paramname"><em>LUNIndex</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="a00003.html">SCSI_Capacity_t</a> *const&#160;</td>
          <td class="paramname"><em>CapacityPtr</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Issues a SCSI Device Read Capacity command to the attached device, to determine the capacity of the given Logical Unit within the device.</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in]</td><td class="paramname">LUNIndex</td><td>Index of the LUN inside the device the command is being addressed to </td></tr>
    <tr><td class="paramdir">[out]</td><td class="paramname">CapacityPtr</td><td>Device capacity structure where the capacity data is to be stored</td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>A value from the Pipe_Stream_RW_ErrorCodes_t enum, or MASS_STORE_SCSI_COMMAND_FAILED if the SCSI command fails </dd></dl>

</div>
</div>
<a class="anchor" id="a5d22ef9933e52861549688342804ddaf"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">uint8_t MassStore_ReadDeviceBlock </td>
          <td>(</td>
          <td class="paramtype">const uint8_t&#160;</td>
          <td class="paramname"><em>LUNIndex</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const uint32_t&#160;</td>
          <td class="paramname"><em>BlockAddress</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const uint8_t&#160;</td>
          <td class="paramname"><em>Blocks</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const uint16_t&#160;</td>
          <td class="paramname"><em>BlockSize</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">void *&#160;</td>
          <td class="paramname"><em>BufferPtr</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Issues a SCSI Device Block Read command to the attached device, to read in one or more data blocks from the storage medium into a buffer.</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in]</td><td class="paramname">LUNIndex</td><td>Index of the LUN inside the device the command is being addressed to </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">BlockAddress</td><td>Start block address to read from </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">Blocks</td><td>Number of blocks to read from the device </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">BlockSize</td><td>Size in bytes of each block to read </td></tr>
    <tr><td class="paramdir">[out]</td><td class="paramname">BufferPtr</td><td>Pointer to the buffer where the read data is to be written to</td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>A value from the Pipe_Stream_RW_ErrorCodes_t enum, or MASS_STORE_SCSI_COMMAND_FAILED if the SCSI command fails </dd></dl>

</div>
</div>
<a class="anchor" id="a5640cbec94f4320ae1bd4b2dfa62b475"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">uint8_t MassStore_RequestSense </td>
          <td>(</td>
          <td class="paramtype">const uint8_t&#160;</td>
          <td class="paramname"><em>LUNIndex</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="a00005.html">SCSI_Request_Sense_Response_t</a> *const&#160;</td>
          <td class="paramname"><em>SensePtr</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Issues a SCSI Request Sense command to the attached device, to determine the current SCSI sense information. This gives error codes for the last issued SCSI command to the device.</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in]</td><td class="paramname">LUNIndex</td><td>Index of the LUN inside the device the command is being addressed to </td></tr>
    <tr><td class="paramdir">[out]</td><td class="paramname">SensePtr</td><td>Pointer to the sense data structure where the sense data from the device is to be stored</td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>A value from the Pipe_Stream_RW_ErrorCodes_t enum, or MASS_STORE_SCSI_COMMAND_FAILED if the SCSI command fails </dd></dl>

</div>
</div>
<a class="anchor" id="a7f889907d9bfcdb0ab685b32d26458f9"></a>
<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static uint8_t MassStore_SendCommand </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="a00001.html">CommandBlockWrapper_t</a> *const&#160;</td>
          <td class="paramname"><em>SCSICommandBlock</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">void *&#160;</td>
          <td class="paramname"><em>BufferPtr</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">
<p>Routine to send the current CBW to the device, and increment the Tag value as needed.</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in]</td><td class="paramname">SCSICommandBlock</td><td>Pointer to a SCSI command block structure to send to the attached device </td></tr>
    <tr><td class="paramdir">[in,out]</td><td class="paramname">BufferPtr</td><td>Pointer to a buffer for the data to send or receive to/from the device, or NULL if no data</td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>A value from the Pipe_Stream_RW_ErrorCodes_t enum </dd></dl>

</div>
</div>
<a class="anchor" id="aa02649a92bc7603ad9f4e90aa48522d8"></a>
<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static uint8_t MassStore_SendReceiveData </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="a00001.html">CommandBlockWrapper_t</a> *const&#160;</td>
          <td class="paramname"><em>SCSICommandBlock</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">void *&#160;</td>
          <td class="paramname"><em>BufferPtr</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">
<p>Sends or receives the transaction's data stage to or from the attached device, reading or writing to the nominated buffer.</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in]</td><td class="paramname">SCSICommandBlock</td><td>Pointer to a SCSI command block structure being sent to the attached device </td></tr>
    <tr><td class="paramdir">[in,out]</td><td class="paramname">BufferPtr</td><td>Pointer to the data buffer to read from or write to</td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>A value from the Pipe_Stream_RW_ErrorCodes_t enum </dd></dl>

</div>
</div>
<a class="anchor" id="ad8e1a76103edb7da05f5c28d805ad985"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">uint8_t MassStore_TestUnitReady </td>
          <td>(</td>
          <td class="paramtype">const uint8_t&#160;</td>
          <td class="paramname"><em>LUNIndex</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Issues a SCSI Device Test Unit Ready command to the attached device, to determine if the device is ready to accept other commands.</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in]</td><td class="paramname">LUNIndex</td><td>Index of the LUN inside the device the command is being addressed to</td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>A value from the Pipe_Stream_RW_ErrorCodes_t enum, or MASS_STORE_SCSI_COMMAND_FAILED if the SCSI command fails </dd></dl>

</div>
</div>
<a class="anchor" id="a0c13e34b17c949e38edd360284deeac0"></a>
<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static uint8_t MassStore_WaitForDataReceived </td>
          <td>(</td>
          <td class="paramtype">void&#160;</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">
<p>Waits until the attached device is ready to accept data following a CBW, checking to ensure that the device has not stalled the transaction.</p>
<dl class="section return"><dt>Returns</dt><dd>A value from the Pipe_Stream_RW_ErrorCodes_t enum </dd></dl>

</div>
</div>
<a class="anchor" id="a5726b87e98539242273e112acec239d6"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">uint8_t MassStore_WriteDeviceBlock </td>
          <td>(</td>
          <td class="paramtype">const uint8_t&#160;</td>
          <td class="paramname"><em>LUNIndex</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const uint32_t&#160;</td>
          <td class="paramname"><em>BlockAddress</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const uint8_t&#160;</td>
          <td class="paramname"><em>Blocks</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const uint16_t&#160;</td>
          <td class="paramname"><em>BlockSize</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">void *&#160;</td>
          <td class="paramname"><em>BufferPtr</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Issues a SCSI Device Block Write command to the attached device, to write one or more data blocks to the storage medium from a buffer.</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in]</td><td class="paramname">LUNIndex</td><td>Index of the LUN inside the device the command is being addressed to </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">BlockAddress</td><td>Start block address to write to </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">Blocks</td><td>Number of blocks to write to in the device </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">BlockSize</td><td>Size in bytes of each block to write </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">BufferPtr</td><td>Pointer to the buffer where the write data is to be sourced from</td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>A value from the Pipe_Stream_RW_ErrorCodes_t enum, or MASS_STORE_SCSI_COMMAND_FAILED if the SCSI command fails </dd></dl>

</div>
</div>
<h2 class="groupheader">Variable Documentation</h2>
<a class="anchor" id="a976546b67de109f645714ba6085fc1bf"></a>
<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">uint32_t MassStore_Tag = 1</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">
<p>Current Tag value used in issued CBWs to the device. This is automatically incremented each time a command is sent, and is not externally accessible. </p>

</div>
</div>
</div><!-- contents -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="navelem"><a class="el" href="dir_8f3de2ae926fecfe6abd5379fd2b6eb1.html">Lib</a></li><li class="navelem"><a class="el" href="a00008.html">MassStoreCommands.c</a></li>
    <li class="footer">Generated by
    <a href="http://www.doxygen.org/index.html">
    <img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.8.7 </li>
  </ul>
</div>
</body>
</html>
